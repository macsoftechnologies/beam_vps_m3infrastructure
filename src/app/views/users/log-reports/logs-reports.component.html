<mat-card class="p-0">
  <mat-card-content class="p-0">

    <!-- Search Bar -->
    <mat-grid-list [cols]="gridCols" rowHeight="80px">
      <mat-grid-tile>
        <mat-form-field appearance="outline">
  <mat-label>Search by Date</mat-label>
  <input 
    matInput 
    [matDatepicker]="picker" 
    placeholder="Choose a date"
    [(ngModel)]="searchedDate"
    (dateChange)="onDateChange($event)">
  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
  <mat-datepicker #picker></mat-datepicker>
</mat-form-field>

      </mat-grid-tile>
    </mat-grid-list>

    <!-- Data Table -->
    <ngx-datatable 
        class="material ml-0 mr-0"
  [rows]="items"
  [columnMode]="'force'"
  [headerHeight]="70"
  [footerHeight]="50"
  [scrollbarH]="true"
  [limit]="30"
  [rowHeight]="'auto'">

<ngx-datatable-column name="Action" [flexGrow]="1" [width]="100">
  <ng-template let-row="row" ngx-datatable-cell-template>
    <span 
      [ngClass]="{
        'text-success': row?.action === 'API_SUCCESS', 
        'text-danger': row?.action === 'API_FAILURE'
      }">
      {{ row?.action }}
    </span>
  </ng-template>
</ngx-datatable-column>


      <ngx-datatable-column name="Method" [flexGrow]="1" [width]="80">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.method }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="URL" [flexGrow]="2" [width]="200">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <a [href]="row?.url" target="_blank">{{ row?.url }}</a>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Status" [flexGrow]="1" [width]="50">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span [ngClass]="{'text-success': row?.status == '200', 'text-danger': row?.status != '200'}">
            {{ row?.status }}
          </span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="User" [flexGrow]="1" [width]="120">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.user?.displayName }}
        </ng-template>
      </ngx-datatable-column>

<ngx-datatable-column name="Body" [flexGrow]="2" [width]="200">
  <ng-template let-row="row" ngx-datatable-cell-template>
    <div *ngIf="parseBody(row?.body) as parsedBody">
      <div *ngFor="let item of parsedBody | keyvalue">
        {{ item.key }}: {{ item.value }}
      </div>
    </div>
    <div *ngIf="!parseBody(row?.body)">
      {{ row?.body }} <!-- fallback if not JSON -->
    </div>
  </ng-template>
</ngx-datatable-column>


      <ngx-datatable-column name="Timestamp" [flexGrow]="1" [width]="150">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.timestamp | date:'medium' }}
        </ng-template>
      </ngx-datatable-column>

   <!-- Pagination -->
<ngx-datatable-footer>
  <ng-template 
    ngx-datatable-footer-template 
    let-rowCount="rowCount" 
    let-pageSize="pageSize"
    let-curPage="curPage">

    <datatable-pager 
      [pagerLeftArrowIcon]="'datatable-icon-left'" 
      [pagerRightArrowIcon]="'datatable-icon-right'"
      [pagerPreviousIcon]="'datatable-icon-prev'" 
      [pagerNextIcon]="'datatable-icon-skip'"
      [page]="curPage" 
      [size]="pageSize" 
      [count]="paginationCount || 0"
      (change)="onPagination($event)">
    </datatable-pager>

  </ng-template>
</ngx-datatable-footer>

    </ngx-datatable>


  </mat-card-content>
</mat-card>

<!-- Loading Spinner -->
<div class="loading-indicator" *ngIf="spinner">
  <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
</div>
